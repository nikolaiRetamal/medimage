CREATE KEYSPACE medimage WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };

DROP KEYSPACE cassandra_defautl_sample;

CREATE TABLE medimage.dicom (
    id_dicom uuid,
    date_import timestamp,
    nom text,
    id_user uuid,
    id_usage uuid,
    id_examen uuid,
    path_file text,
    PRIMARY KEY (id_dicom)
);

CREATE TABLE medimage.tag (
    id_dicom uuid,
    name text,
    codifie boolean,
    PRIMARY KEY (id_dicom, name)
);

CREATE TABLE medimage.metadata (
    id_dicom uuid,
	key text,
	value text,
    PRIMARY KEY (id_dicom, key, value)
);

CREATE TABLE medimage.user (
    
    PRIMARY KEY (id_dicom)
);

CREATE TABLE medimage.usage (
    id_dicom uuid,
    date_import timestamp,
    nom text,
    id_user int,
    id_usage int,
    tag list<text>,
    metadata map<text,text>,
    PRIMARY KEY (id_dicom)
);

CREATE TABLE medimage.examen (
    id_dicom uuid,
    date_import timestamp,
    nom text,
    id_user int,
    id_usage int,
    tag list<text>,
    metadata map<text,text>,
    PRIMARY KEY (id_dicom)
);

CREATE TABLE medimage.dicom (
    id_dicom uuid,
    date_import timestamp,
    nom text,
    id_user int,
    id_usage int,
    tag list<text>,
    metadata map<text,text>,
    PRIMARY KEY (id_dicom)
);

CREATE index ON medimage.dicom(tag);
CREATE index ON medimage.dicom (metadata);

INSERT INTO medimage.dicom (id_dicom, date_import, nom, id_user, id_usage, metadata)  VALUES ( now(), dateof(now()), 'gerard', 1,2,{});




INSERT INTO medimage.dicom (id_dicom, date_import, nom, id_user, id_usage, tag, metadata)
  VALUES ( now(), dateof(now()), 'gerard', 1,2,['obiwan','luke','dark'],{'key1' : 'Mabite'});
  
  SELECT *
  FROM medimage.dicom
  WHERE metadata['maBite'] = 'JeanLuc';
  
  
  ALTER TABL